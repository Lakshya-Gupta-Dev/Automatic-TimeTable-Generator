<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;}
    body { display:flex; min-height:100vh; background:#f4f7fb; }

    /* Sidebar */
    .sidebar {
      width:230px;
      background:#1a1a2e;
      color:white;
      height:100vh;
      padding:20px;
      position:fixed;
      display:flex;
      flex-direction:column;
    }
    .sidebar h3 {
      text-align:center;
      margin-bottom:30px;
      color:#00bcd4;
    }
    .sidebar a {
      display:block;
      color:white;
      padding:10px;
      margin:8px 0;
      border-radius:6px;
      text-decoration:none;
      transition:0.3s;
    }
    .sidebar a:hover, .sidebar a.active {
      background:#00bcd4;
      color:#111;
      font-weight:600;
    }

    /* Main Section */
    .main-content {
      margin-left:230px;
      width:calc(100% - 230px);
      padding:20px;
      display:flex;
      flex-direction:column;
    }

    /* Navbar */
    .navbar {
      background:#fff;
      border-radius:10px;
      padding:10px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
    }
    .navbar .search-box input {
      padding:8px 12px;
      border-radius:6px;
      border:1px solid #ccc;
      outline:none;
    }
    .navbar .profile {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .navbar .profile img {
      width:40px;
      height:40px;
      border-radius:50%;
      border:2px solid #00bcd4;
    }
    .navbar .profile span {
      font-weight:600;
    }
    .logout-btn {
      padding:6px 12px;
      background:#dc2626;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      transition:0.3s;
    }
    .logout-btn:hover {
      background:#b91c1c;
    }

    /* Content */
    .content {
      background:#fff;
      padding:30px;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.09);
      margin-top:30px;
    }

    .conhome {
      background:#fff;
      display:inline-block;
      padding:20px;
      margin:15px;
      border-radius:10px;
      width:180px;
      text-align:center;
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
    }

    .second {
      display:flex;
      gap:20px;
      margin-top:30px;
      flex-wrap:wrap;
      justify-content:center;
    }

    .con1 {
      flex:1;
      min-width:250px;
      background:#fff;
      border-radius:10px;
      padding:20px;
      text-align:center;
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
    }
    .con1 img {
      width:100px;
      height:100px;
      border-radius:10px;
      margin-bottom:10px;
    }
    .con1 button {
      margin-top:10px;
      border:none;
      background:#3b82f6;
      color:#fff;
      padding:6px 14px;
      border-radius:6px;
      cursor:pointer;
    }
    .con1 button:hover {
      background:#2563eb;
    }

    .footer {
      margin-top:40px;
      text-align:center;
      padding:10px;
      background:#1a1a2e;
      color:white;
      border-radius:10px;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h3>Menu</h3>
    <a href="home.html" class="active">üè† Home</a>
    <a href="schedules.html">üìÖ Schedules</a>
    <a href="classes.html">üéì Classes</a>
    <a href="teachers.html">üë®‚Äçüè´ Teachers</a>
    <a href="departments.html">üè¢ Departments</a>
    <a href="subject.html">üìò Subject</a>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="navbar">
      <div class="search-box">
        <input type="text" placeholder="Search..." />
      </div>
      <div class="profile">
        <img src="sc1.png" alt="User" />
        <span id="usernameDisplay">Loading...</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <div class="content">
      <h4 class="mb-4">Welcome to Timetable Dashboard üëã</h4>

      <div class="mb-4">
        <span class="conhome">Classes
          <h1 id="classCount">0</h1>
        </span>
        <span class="conhome">Departments
          <h1 id="deptCount">0</h1>
        </span>
        <span class="conhome">Teachers
          <h1 id="teacherCount">0</h1>
        </span>
      </div>

      <div class="second">
        <div class="con1">
          <img src="pdf1.webp" alt="PDF" />
          <h3>PDF File</h3>
          <button onclick="downloadFile('pdf')">Download</button>
        </div>

        <div class="con1">
          <img src="do1.jpg" alt="DOCX" />
          <h3>Docx File</h3>
          <button onclick="downloadFile('docx')">Download</button>
        </div>

        <div class="con1">
          <img src="ex2.jpg" alt="Excel" />
          <h3>Excel File</h3>
          <button onclick="downloadFile('excel')">Download</button>
        </div>
      </div>
    </div>

    <div class="footer">
      Time Table Generator || By SVVV Students 2025
    </div>
  </div>

  <script>
    const API_BASE = "http://localhost:8080/api";

    async function loadUser() {
      const token = localStorage.getItem("token");
      if (!token) { logout(); return; }

      const res = await fetch(`${API_BASE}/user/profile`, {
        headers: { Authorization: "Bearer " + token }
      });

      if (res.ok) {
        const user = await res.json();
        document.getElementById("usernameDisplay").textContent =
          user.username || user.email || "User";
      } else {
        logout();
      }
    }

    function logout() {
      localStorage.removeItem("token");
      window.location.href = "login1.html";
    }

    function downloadFile(type) {
      const token = localStorage.getItem("token");
      if (!token) { alert("Please login again."); return; }

      const link = document.createElement("a");
      if (type === 'pdf') link.href = `${API_BASE}/user/schedule/export/pdf`;
      else if (type === 'docx') link.href = `${API_BASE}/user/schedule/export/docx`;
      else link.href = `${API_BASE}/user/schedule/export/excel`;
      link.setAttribute("download", `timetable.${type}`);
      link.click();
    }

    loadUser();
  </script>

</body>
</html>
